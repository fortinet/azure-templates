{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "basics": {
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "resourceTypes": [
      "microsoft.resources/resourcegroups"
    ],
    "basics": [
      {
        "name": "instancetypeinfo",
        "type": "Microsoft.Common.InfoBox",
        "visible": true,
        "options": {
          "icon": "Info",
          "text": "FortiGate Deployment Type - Active/Active - External and Internal Load Balancers - Availability Set or Availability Zones",
          "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiGate/Active-Active-ELB-ILB"
        }
      },
      {
        "name": "fortiGateInstanceArchitecture",
        "type": "Microsoft.Common.OptionsGroup",
        "label": "FortiGate VM instance Architecture",
        "defaultValue": "X64 - Intel / AMD based processors",
        "toolTip": "Select FortiGate VM instance Architecture",
        "constraints": {
          "allowedValues": [
            {
              "label": "X64 - Intel / AMD based processors",
              "value": "x64"
            },
            {
              "label": "ARM64 - Ampere Altra based processors",
              "value": "arm64"
            }
          ],
          "required": true
        },
        "visible": true
      },
      {
        "name": "adminUsername",
        "type": "Microsoft.Common.TextBox",
        "label": "FortiGate administrative username",
        "defaultValue": "",
        "toolTip": "Username for the FortiGate virtual appliance. May not be root, administrator or admin",
        "constraints": {
          "required": true,
          "validations": [
            {
              "regex": "^[a-z0-9A-Z]{1,30}$",
              "message": "Only alphanumeric characters are allowed, and the value must be 1-30 characters long"
            },
            {
              "isValid": "[not(contains(toLower(basics('adminUsername')),'root'))]",
              "message": "Usernames must not include reserved words"
            },
            {
              "isValid": "[not(contains(toLower(basics('adminUsername')),'admin'))]",
              "message": "Usernames must not include reserved words"
            }
          ]
        },
        "visible": true
      },
      {
        "name": "adminPassword",
        "type": "Microsoft.Common.PasswordBox",
        "label": {
          "password": "FortiGate password",
          "confirmPassword": "Confirm password"
        },
        "toolTip": "Password for the Virtual Machine",
        "constraints": {
          "required": true,
          "regex": "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{12,}$",
          "validationMessage": "The password must be between 12 characters and 72 characters, and contain characters from at least 3 of the following 4 complexity requirements: uppercase characters, lowercase characters, numbers, and special characters (regex match [\\W_])."
        },
        "options": {
          "hideConfirmation": false
        },
        "visible": true
      },
      {
        "name": "fortiGateNamePrefix",
        "type": "Microsoft.Common.TextBox",
        "label": "FortiGate Name Prefix",
        "defaultValue": "",
        "toolTip": "Naming prefix for all deployed resources. The FortiGate VMs will have the suffix '-fgt-a' and '-fgt-b'. For example if the prefix is 'acme-01' the FortiGates will be named 'acme-01-fgt-a' and 'acme-01-fgt-b'",
        "constraints": {
          "required": true,
          "regex": "^[A-Za-z0-9-]{1,15}$",
          "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1 to 15 characters."
        },
        "visible": true
      },
      {
        "name": "fortiGateCount",
        "type": "Microsoft.Common.TextBox",
        "label": "Number of FortiGate",
        "defaultValue": "2",
        "toolTip": "Number of FortiGate VM instances to deploy",
        "constraints": {
          "required": true,
          "regex": "^[0-9-]{1,15}$",
          "validationMessage": "Only alphanumeric characters are allowed, and the value must be 1 to 15 characters."
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "instance",
        "label": "Instance",
        "subLabel": {
          "preValidation": "Select instance type",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "instancetype_x64",
            "type": "Microsoft.Common.Section",
            "label": "Instance Type x64",
            "elements": [
              {
                "name": "fortiGateImageSKU_x64",
                "type": "Microsoft.Common.DropDown",
                "label": "FortiGate Image SKU",
                "defaultValue": "Bring Your Own License or FortiFlex",
                "toolTip": "Identifies whether to to use PAYG (on demand licensing) or BYOL license model (where license is purchased separately)",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Bring Your Own License or FortiFlex",
                      "value": "fortinet_fg-vm"
                    },
                    {
                      "label": "Pay As You Go",
                      "value": "fortinet_fg-vm_payg_2023"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "fortiGateImageVersion_x64",
                "type": "Microsoft.Common.DropDown",
                "label": "FortiGate Image Version",
                "defaultValue": "7.4.6",
                "toolTip": "Select the FortiGate image version",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "latest",
                      "value": "latest"
                    },
                    {
                      "label": "7.6.2",
                      "value": "7.6.2"
                    },
                    {
                      "label": "7.6.1",
                      "value": "7.6.1"
                    },
                    {
                      "label": "7.6.0",
                      "value": "7.6.0"
                    },
                    {
                      "label": "7.4.6",
                      "value": "7.4.6"
                    },
                    {
                      "label": "7.4.5",
                      "value": "7.4.5"
                    },
                    {
                      "label": "7.4.4",
                      "value": "7.4.4"
                    },
                    {
                      "label": "7.4.3",
                      "value": "7.4.3"
                    },
                    {
                      "label": "7.4.2",
                      "value": "7.4.2"
                    },
                    {
                      "label": "7.4.1",
                      "value": "7.4.1"
                    },
                    {
                      "label": "7.4.0",
                      "value": "7.4.0"
                    },
                    {
                      "label": "7.2.10",
                      "value": "7.2.10"
                    },
                    {
                      "label": "7.2.9",
                      "value": "7.2.9"
                    },
                    {
                      "label": "7.2.8",
                      "value": "7.2.8"
                    },
                    {
                      "label": "7.2.7",
                      "value": "7.2.7"
                    },
                    {
                      "label": "7.2.6",
                      "value": "7.2.6"
                    },
                    {
                      "label": "7.2.5",
                      "value": "7.2.5"
                    },
                    {
                      "label": "7.2.4",
                      "value": "7.2.4"
                    },
                    {
                      "label": "7.2.3",
                      "value": "7.2.3"
                    },
                    {
                      "label": "7.2.2",
                      "value": "7.2.2"
                    },
                    {
                      "label": "7.2.1",
                      "value": "7.2.1"
                    },
                    {
                      "label": "7.2.0",
                      "value": "7.2.0"
                    },
                    {
                      "label": "7.0.15",
                      "value": "7.0.15"
                    },
                    {
                      "label": "7.0.14",
                      "value": "7.0.14"
                    },
                    {
                      "label": "7.0.13",
                      "value": "7.0.13"
                    },
                    {
                      "label": "7.0.12",
                      "value": "7.0.12"
                    },
                    {
                      "label": "7.0.11",
                      "value": "7.0.11"
                    },
                    {
                      "label": "7.0.10",
                      "value": "7.0.10"
                    },
                    {
                      "label": "7.0.9",
                      "value": "7.0.9"
                    },
                    {
                      "label": "7.0.8",
                      "value": "7.0.8"
                    },
                    {
                      "label": "7.0.6",
                      "value": "7.0.6"
                    },
                    {
                      "label": "7.0.5",
                      "value": "7.0.5"
                    },
                    {
                      "label": "7.0.4",
                      "value": "7.0.4"
                    },
                    {
                      "label": "7.0.3",
                      "value": "7.0.3"
                    },
                    {
                      "label": "7.0.2",
                      "value": "7.0.2"
                    },
                    {
                      "label": "7.0.1",
                      "value": "7.0.1"
                    },
                    {
                      "label": "7.0.0",
                      "value": "7.0.0"
                    },
                    {
                      "label": "6.4.15",
                      "value": "6.4.15"
                    },
                    {
                      "label": "6.4.13",
                      "value": "6.4.13"
                    },
                    {
                      "label": "6.4.12",
                      "value": "6.4.12"
                    },
                    {
                      "label": "6.4.11",
                      "value": "6.4.11"
                    },
                    {
                      "label": "6.4.10",
                      "value": "6.4.10"
                    },
                    {
                      "label": "6.4.9",
                      "value": "6.4.9"
                    },
                    {
                      "label": "6.4.8",
                      "value": "6.4.8"
                    },
                    {
                      "label": "6.4.7",
                      "value": "6.4.7"
                    },
                    {
                      "label": "6.4.6",
                      "value": "6.4.6"
                    },
                    {
                      "label": "6.4.5",
                      "value": "6.4.5"
                    },
                    {
                      "label": "6.4.3",
                      "value": "6.4.3"
                    },
                    {
                      "label": "6.4.2",
                      "value": "6.4.2"
                    },
                    {
                      "label": "6.4.0",
                      "value": "6.4.0"
                    },
                    {
                      "label": "6.2.5",
                      "value": "6.2.5"
                    },
                    {
                      "label": "6.2.4",
                      "value": "6.2.4"
                    },
                    {
                      "label": "6.2.2",
                      "value": "6.2.2"
                    },
                    {
                      "label": "6.2.0",
                      "value": "6.2.0"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "info",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "For this FortiGate deployment, it is recommended to use the general purpose or compute optimized virtual machines. A selection of supported instances sizes is listed in our documentation.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.4.0/azure-administration-guide/562841/instance-type-support"
                  }
                }
              },
              {
                "name": "selection_x64",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Size",
                "toolTip": "Select the instance size of your FortiGate VM solution. Minimum 2 NICs are required.",
                "recommendedSizes": [
                  "Standard_F2s",
                  "Standard_F4s",
                  "Standard_F8s",
                  "Standard_F16s",
                  "Standard_F2",
                  "Standard_F4",
                  "Standard_F8",
                  "Standard_F16",
                  "Standard_F2s_v2",
                  "Standard_F4s_v2",
                  "Standard_F8s_v2",
                  "Standard_F16s_v2",
                  "Standard_F32s_v2",
                  "Standard_DS1_v2",
                  "Standard_DS2_v2",
                  "Standard_DS3_v2",
                  "Standard_DS4_v2",
                  "Standard_DS5_v2",
                  "Standard_D2s_v3",
                  "Standard_D4s_v3",
                  "Standard_D8s_v3",
                  "Standard_D16s_v3",
                  "Standard_D32s_v3",
                  "Standard_D2_v4",
                  "Standard_D4_v4",
                  "Standard_D8_v4",
                  "Standard_D16_v4",
                  "Standard_D32_v4",
                  "Standard_D2s_v4",
                  "Standard_D4s_v4",
                  "Standard_D8s_v4",
                  "Standard_D16s_v4",
                  "Standard_D32s_v4",
                  "Standard_D2a_v4",
                  "Standard_D4a_v4",
                  "Standard_D8a_v4",
                  "Standard_D16a_v4",
                  "Standard_D32a_v4",
                  "Standard_D2as_v4",
                  "Standard_D4as_v4",
                  "Standard_D8as_v4",
                  "Standard_D16as_v4",
                  "Standard_D32as_v4",
                  "Standard_D2_v5",
                  "Standard_D4_v5",
                  "Standard_D8_v5",
                  "Standard_D16_v5",
                  "Standard_D32_v5",
                  "Standard_D2s_v5",
                  "Standard_D4s_v5",
                  "Standard_D8s_v5",
                  "Standard_D16s_v5",
                  "Standard_D32s_v5",
                  "Standard_D2as_v5",
                  "Standard_D4as_v5",
                  "Standard_D8as_v5",
                  "Standard_D16as_v5",
                  "Standard_D32as_v5",
                  "Standard_D2ads_v5",
                  "Standard_D4ads_v5",
                  "Standard_D8ads_v5",
                  "Standard_D16ads_v5",
                  "Standard_D32ads_v5"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_F2s",
                    "Standard_F4s",
                    "Standard_F8s",
                    "Standard_F16s",
                    "Standard_F2",
                    "Standard_F4",
                    "Standard_F8",
                    "Standard_F16",
                    "Standard_F2s_v2",
                    "Standard_F4s_v2",
                    "Standard_F8s_v2",
                    "Standard_F16s_v2",
                    "Standard_F32s_v2",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_D2s_v3",
                    "Standard_D4s_v3",
                    "Standard_D8s_v3",
                    "Standard_D16s_v3",
                    "Standard_D32s_v3",
                    "Standard_D2_v4",
                    "Standard_D4_v4",
                    "Standard_D8_v4",
                    "Standard_D16_v4",
                    "Standard_D32_v4",
                    "Standard_D2s_v4",
                    "Standard_D4s_v4",
                    "Standard_D8s_v4",
                    "Standard_D16s_v4",
                    "Standard_D32s_v4",
                    "Standard_D2a_v4",
                    "Standard_D4a_v4",
                    "Standard_D8a_v4",
                    "Standard_D16a_v4",
                    "Standard_D32a_v4",
                    "Standard_D2as_v4",
                    "Standard_D4as_v4",
                    "Standard_D8as_v4",
                    "Standard_D16as_v4",
                    "Standard_D32as_v4",
                    "Standard_D2_v5",
                    "Standard_D4_v5",
                    "Standard_D8_v5",
                    "Standard_D16_v5",
                    "Standard_D32_v5",
                    "Standard_D2s_v5",
                    "Standard_D4s_v5",
                    "Standard_D8s_v5",
                    "Standard_D16s_v5",
                    "Standard_D32s_v5",
                    "Standard_D2as_v5",
                    "Standard_D4as_v5",
                    "Standard_D8as_v5",
                    "Standard_D16as_v5",
                    "Standard_D32as_v5",
                    "Standard_D2ads_v5",
                    "Standard_D4ads_v5",
                    "Standard_D8ads_v5",
                    "Standard_D16ads_v5",
                    "Standard_D32ads_v5",
                    "Standard_D2ps_v5",
                    "Standard_D4ps_v5",
                    "Standard_D8ps_v5",
                    "Standard_D16ps_v5",
                    "Standard_D32ps_v5",
                    "Standard_D2pds_v5",
                    "Standard_D4pds_v5",
                    "Standard_D8pds_v5",
                    "Standard_D16pds_v5",
                    "Standard_D32pds_v5",
                    "Standard_D2pls_v5",
                    "Standard_D4pls_v5",
                    "Standard_D8pls_v5",
                    "Standard_D16pls_v5",
                    "Standard_D32pls_v5",
                    "Standard_D2plds_v5",
                    "Standard_D4plds_v5",
                    "Standard_D8plds_v5",
                    "Standard_D16plds_v5",
                    "Standard_D32plds_v5",
                    "Standard_E2ps_v5",
                    "Standard_E4ps_v5",
                    "Standard_E8ps_v5",
                    "Standard_E16ps_v5",
                    "Standard_E32ps_v5",
                    "Standard_E2pds_v5",
                    "Standard_E4pds_v5",
                    "Standard_E8pds_v5",
                    "Standard_E16pds_v5",
                    "Standard_E32pds_v5"
                  ]
                },
                "options": {
                  "hideDiskTypeFilter": false
                },
                "osPlatform": "Linux",
                "imageReference": {
                  "publisher": "Fortinet",
                  "offer": "fortinet_fortigate-vm_v5",
                  "sku": "[if(or(equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.1'),equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.2'), equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'latest')),concat(steps('instance').instancetype_x64.fortiGateImageSKU_x64,'_g2'),steps('instance').instancetype_x64.fortiGateImageSKU_x64)]"
                },
                "count": 2,
                "visible": true
              },
              {
                "name": "versionInfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": "[and(contains(steps('instance').instancetype_x64.selection_x64, '_v6'),not(or(equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.1'),equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.2'),equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'latest'))))]",
                "options": {
                  "icon" : "Error",
                  "text": "Dsv6 and Esv6 Instance families require a Gen2 VM Image, support for MANA network drivers and are incompatible with the selected FortiGate version, please select version 7.6.1 or higher",
                  "uri": "https://azure.microsoft.com/en-ca/updates/public-preview-internet-inbound-for-network-virtual-appliances-in-virtual-wan-hubs/"
                }  
              }
            ],
            "visible": "[equals(basics('fortiGateInstanceArchitecture'),'x64')]"
          },
          {
            "name": "instancetype_arm64",
            "type": "Microsoft.Common.Section",
            "label": "Instance Type ARM 64",
            "elements": [
              {
                "name": "fortiGateImageSKU_arm64",
                "type": "Microsoft.Common.DropDown",
                "label": "FortiGate Image SKU",
                "defaultValue": "Bring Your Own License or FortiFlex",
                "toolTip": "Identifies whether to to use PAYG (on demand licensing) or BYOL license model (where license is purchased separately)",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Bring Your Own License or FortiFlex",
                      "value": "fortinet_fg-vm_arm64"
                    },
                    {
                      "label": "Pay As You Go",
                      "value": "fortinet_fg-vm_payg_2023_arm64"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "fortiGateImageVersion_arm64",
                "type": "Microsoft.Common.DropDown",
                "label": "FortiGate Image Version",
                "defaultValue": "7.4.6",
                "toolTip": "Select the FortiGate image version",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "latest",
                      "value": "latest"
                    },
                    {
                      "label": "7.6.2",
                      "value": "7.6.2"
                    },
                    {
                      "label": "7.6.1",
                      "value": "7.6.1"
                    },
                    {
                      "label": "7.6.0",
                      "value": "7.6.0"
                    },
                    {
                      "label": "7.4.6",
                      "value": "7.4.6"
                    },
                    {
                      "label": "7.4.5",
                      "value": "7.4.5"
                    },
                    {
                      "label": "7.4.4",
                      "value": "7.4.4"
                    },
                    {
                      "label": "7.4.3",
                      "value": "7.4.3"
                    },
                    {
                      "label": "7.2.10",
                      "value": "7.2.10"
                    },
                    {
                      "label": "7.2.9",
                      "value": "7.2.9"
                    },
                    {
                      "label": "7.2.8",
                      "value": "7.2.8"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "info",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "For this FortiGate deployment, it is recommended to use the general purpose or compute optimized virtual machines. A selection of supported instances sizes is listed in our documentation.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.4.0/azure-administration-guide/562841/instance-type-support"
                  }
                }
              },
              {
                "name": "selection_arm64",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Size",
                "toolTip": "Select the instance size of your FortiGate VM solution. Minimum 2 NICs are required.",
                "recommendedSizes": [
                  "Standard_D2ps_v6",
                  "Standard_D4ps_v6",
                  "Standard_D8ps_v6",
                  "Standard_D16ps_v6",
                  "Standard_D32ps_v6",
                  "Standard_D2ps_v5",
                  "Standard_D4ps_v5",
                  "Standard_D8ps_v5",
                  "Standard_D16ps_v5",
                  "Standard_D32ps_v5",
                  "Standard_D2pds_v5",
                  "Standard_D4pds_v5",
                  "Standard_D8pds_v5",
                  "Standard_D16pds_v5",
                  "Standard_D32pds_v5",
                  "Standard_D2pls_v5",
                  "Standard_D4pls_v5",
                  "Standard_D8pls_v5",
                  "Standard_D16pls_v5",
                  "Standard_D32pls_v5",
                  "Standard_D2plds_v5",
                  "Standard_D4plds_v5",
                  "Standard_D8plds_v5",
                  "Standard_D16plds_v5",
                  "Standard_D32plds_v5",
                  "Standard_E2ps_v5",
                  "Standard_E4ps_v5",
                  "Standard_E8ps_v5",
                  "Standard_E16ps_v5",
                  "Standard_E32ps_v5",
                  "Standard_E2pds_v5",
                  "Standard_E4pds_v5",
                  "Standard_E8pds_v5",
                  "Standard_E16pds_v5",
                  "Standard_E32pds_v5"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_D2ps_v6",
                    "Standard_D4ps_v6",
                    "Standard_D8ps_v6",
                    "Standard_D16ps_v6",
                    "Standard_D32ps_v6",
                    "Standard_D2ps_v5",
                    "Standard_D4ps_v5",
                    "Standard_D8ps_v5",
                    "Standard_D16ps_v5",
                    "Standard_D32ps_v5",
                    "Standard_D2pds_v5",
                    "Standard_D4pds_v5",
                    "Standard_D8pds_v5",
                    "Standard_D16pds_v5",
                    "Standard_D32pds_v5",
                    "Standard_D2pls_v5",
                    "Standard_D4pls_v5",
                    "Standard_D8pls_v5",
                    "Standard_D16pls_v5",
                    "Standard_D32pls_v5",
                    "Standard_D2plds_v5",
                    "Standard_D4plds_v5",
                    "Standard_D8plds_v5",
                    "Standard_D16plds_v5",
                    "Standard_D32plds_v5",
                    "Standard_E2ps_v5",
                    "Standard_E4ps_v5",
                    "Standard_E8ps_v5",
                    "Standard_E16ps_v5",
                    "Standard_E32ps_v5",
                    "Standard_E2pds_v5",
                    "Standard_E4pds_v5",
                    "Standard_E8pds_v5",
                    "Standard_E16pds_v5",
                    "Standard_E32pds_v5"
                  ]
                },
                "options": {
                  "hideDiskTypeFilter": false
                },
                "osPlatform": "Linux",
                "imageReference": {
                  "publisher": "Fortinet",
                  "offer": "fortinet_fortigate-vm_v5",
                  "sku": "[steps('instance').instancetype_arm64.fortiGateImageSKU_arm64]"
                },
                "count": 2,
                "visible": true
              }
            ],
            "visible": "[equals(basics('fortiGateInstanceArchitecture'),'arm64')]"
          },
          {
            "name": "availabilityOptions",
            "type": "Microsoft.Common.Section",
            "label": "Availability Options",
            "elements": [
              {
                "name": "availabilityOptionsHeader",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Deploy FortiGate VMs in an Availability Set or Availability Zones.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiGate#sla"
                  }
                }
              },
              {
                "name": "availabilityOptions",
                "type": "Microsoft.Common.DropDown",
                "label": "Availability Option",
                "defaultValue": "Availability Zones",
                "toolTip": "Deploy FortiGate VMs in an Availability Set or Availability Zones.",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Availability Set",
                      "value": "Availability Set"
                    },
                    {
                      "label": "Availability Zones",
                      "value": "Availability Zones"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "availabilityOptionsFooter",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "If Availability Zones deployment is selected but the location does not support Availability Zones an Availability Set will be deployed. If Availability Zones deployment is selected and Availability Zones are available in the location, FortiGate A will be placed in Zone 1, FortiGate B will be placed in Zone 2",
                  "uri": "https://docs.microsoft.com/en-us/azure/availability-zones/az-overview"
                }
              }
            ]
          },
          {
            "name": "fgtLicense",
            "type": "Microsoft.Common.Section",
            "label": "FortiGate License",
            "elements": [
              {
                "name": "fgtLicenseBYOLInfo",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Bring Your Own License was selected in the basics blade. The license file(s) retrieved from support.fortinet.com can be uploaded here or uploaded after deployment. License files or FortiFlex license for the first three FortiGate VM systems can be provided via this deployment. Additional licenses need to be uplaoded localy on these systems after deployment or a custom template need to created."
                },
                "visible": "[or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64'))]"
              },
              {
                "name": "fgtLicenseFortiFlexCheck",
                "type": "Microsoft.Common.CheckBox",
                "label": "My organisation is using the FortiFlex subscription service.",
                "toolTip": "My organisation is using the FortiFlex subscription service.",
                "visible": "[or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64'))]"
              },
              {
                "name": "fgt1content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 1 License",
                "toolTip": "Upload the license file FortiGate VM 1 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),1),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt2content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 2 License",
                "toolTip": "Upload the license file FortiGate VM 2 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),2),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt3content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 3 License",
                "toolTip": "Upload the license file FortiGate VM 3 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),3),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt4content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 4 License",
                "toolTip": "Upload the license file FortiGate VM 4 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),4),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt5content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 5 License",
                "toolTip": "Upload the license file FortiGate VM 5 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),5),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt6content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 6 License",
                "toolTip": "Upload the license file FortiGate VM 6 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),6),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt7content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 7 License",
                "toolTip": "Upload the license file FortiGate VM 7 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),7),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt8content",
                "type": "Microsoft.Common.FileUpload",
                "label": "FortiGate 8 License",
                "toolTip": "Upload the license file FortiGate VM 8 BYOL here.",
                "constraints": {
                  "required": false,
                  "accept": ".lic,.txt"
                },
                "options": {
                  "multiple": false,
                  "uploadMode": "file",
                  "openMode": "text",
                  "encoding": "UTF-8"
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),8),not(steps('instance').fgtLicense.fgtLicenseFortiFlexCheck))]"
              },
              {
                "name": "fgt1fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 1 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 1 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),1),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt2fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 2 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 2 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),2),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt3fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 3 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 3 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),3),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt4fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 4 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 4 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),4),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt5fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 5 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 5 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),5),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt6fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 6 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 6 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),6),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt7fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 7 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 7 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),7),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgt8fortiflex",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiGate 8 FortiFlex",
                "defaultValue": "",
                "toolTip": "FortiGate VM 8 FortiFlex license token",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": "[and(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')),greaterOrEquals(int(basics('fortiGateCount')),8),steps('instance').fgtLicense.fgtLicenseFortiFlexCheck)]"
              },
              {
                "name": "fgtLicensePAYGInfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "Pay As You Go licenses was selected in the basics blade and provisioned automatically durig deployment. Registration of the PAYG license is required to receive support.",
                  "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.4.0/azure-administration-guide/533394/creating-a-support-account"
                },
                "visible": "[not(or(equals(steps('instance').instancetype_x64.fortiGateImageSKU_x64, 'fortinet_fg-vm'),equals(steps('instance').instancetype_arm64.fortiGateImageSKU_arm64, 'fortinet_fg-vm_arm64')))]"
              },
              {
                "name": "fgtLicenseMigrateInfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "Migration between BYOL and PAYG is possible using a redeployment of the VM.",
                  "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.4.0/azure-administration-guide/81283/migrating-a-fortigate-vm-instance-between-license-types"
                },
                "visible": true
              }
            ]
          }
        ]
      },
      {
        "name": "networking",
        "label": "Networking",
        "subLabel": {
          "preValidation": "Configure internal networking",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "virtualnetworksection",
            "type": "Microsoft.Common.Section",
            "label": "Configure Internal Networking",
            "elements": [
              {
                "name": "virtualnetworktext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Create a new or select an existing virtual network with the required subnets. The internal subnet is a transit subnet containing only the FortiGate interfaces. Servers can be installed in a protected subnet with user defined routing configuration."
                }
              },
              {
                "name": "virtualnetwork",
                "type": "Microsoft.Network.VirtualNetworkCombo",
                "label": {
                  "virtualNetwork": "Virtual network",
                  "subnets": "Subnets"
                },
                "toolTip": {
                  "virtualNetwork": "Virtual Network for deployment of the FortiGate VM solution",
                  "subnets": "Standard deployment is to have external and internal subnets."
                },
                "defaultValue": {
                  "name": "[if(equals(basics('fortiGateNamePrefix'),''),'fortigte-vnet',concat(basics('fortiGateNamePrefix'),'-vnet'))]",
                  "addressPrefixSize": "/22"
                },
                "constraints": {
                  "minAddressPrefixSize": "/29"
                },
                "options": {
                  "hideExisting": false
                },
                "subnets": {
                  "subnet1": {
                    "label": "External Subnet",
                    "defaultValue": {
                      "name": "externalsubnet",
                      "addressPrefixSize": "/26"
                    },
                    "constraints": {
                      "minAddressPrefixSize": "/29",
                      "minAddressCount": 2,
                      "requireContiguousAddresses": true
                    }
                  },
                  "subnet2": {
                    "label": "Internal subnet",
                    "defaultValue": {
                      "name": "internalsubnet",
                      "addressPrefixSize": "/26"
                    },
                    "constraints": {
                      "minAddressPrefixSize": "/29",
                      "minAddressCount": 3,
                      "requireContiguousAddresses": true
                    }
                  }
                },
                "visible": true
              },
              {
                "name": "virtualnetworkinfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "The internal subnet is a transit subnet containing only the FortiGate interfaces for traffic to and from the internal networks. Internal systems should be installed in a protected subnet with user defined route configuration.",
                  "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiGate/Active-Active-ELB-ILB"
                }
              }
            ]
          },
          {
            "name": "acceleratednetworksection",
            "type": "Microsoft.Common.Section",
            "label": "Accelerated networking",
            "elements": [
              {
                "name": "acceleratednetworkingtext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Enables SR-IOV support allowing direct acces from the NIC in the Azure infrastructure to the FortiGate VM.",
                  "link": {
                    "label": "Learn more",
                    "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.4.0/azure-administration-guide/651644/enabling-accelerated-networking-on-the-fortigate-vm"
                  }
                }
              },
              {
                "name": "acceleratednetworking",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Accelerated Networking",
                "defaultValue": "Enabled",
                "toolTip": "Accelerated Networking enables direct connection between the VM and network card. Only available on 2 CPU F/Fs and 4 CPU D/Dsv2, D/Dsv3, E/Esv3, Fsv2, Lsv2, Ms/Mms and Ms/Mmsv2",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Enabled",
                      "value": "true"
                    },
                    {
                      "label": "Disabled",
                      "value": "false"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "acceleratednetworkinginfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "Accelerated Networking is supported on most general purpose and compute-optimized instance sizes with 2 or more vCPUs. On instances that support hyperthreading, Accelerated Networking is supported on VM instances with 4 or more vCPUs. Deployment with the accelerated networking feature enabled on a host that doesn't support it will result in a failure to connect to it. The accelerated networking can be disabled after deployment from the Azure Portal or Azure CLI.",
                  "uri": "https://docs.microsoft.com/en-us/azure/virtual-machines/sizes"
                }
              },
              {
                "name": "acceleratedconnectionscheck",
                "type": "Microsoft.Common.CheckBox",
                "label": "Accelerated Connections feature (PREVIEW)",
                "toolTip": "This option enables the Accelerated Connections feature. provides higher bandwidth at an additional cost",
                "visible": "[and(equals(steps('networking').acceleratednetworksection.acceleratednetworking, 'true'),equals(basics('fortiGateInstanceArchitecture'),'x64'),not(contains(steps('instance').instancetype_x64.selection_x64, 'v5')))]"
              },
              {
                "name": "acceleratedconnectionssku",
                "type": "Microsoft.Common.DropDown",
                "label": "Auxiliary SKU - Bandwidth Tiers",
                "defaultValue": "A1 - 4vCPU and above",
                "toolTip": "This option selects the required bandwidth capability. SKUs incur additional cost when selected.",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "A1 - 4vCPU and above",
                      "value": "A1"
                    },
                    {
                      "label": "A2 - 4vCPU and above",
                      "value": "A2"
                    },
                    {
                      "label": "A4 - 8vCPU and above",
                      "value": "A4"
                    },
                    {
                      "label": "A8 - 32vCPU and above",
                      "value": "A8"
                    }
                  ]
                },
                "visible": "[and(steps('networking').acceleratednetworksection.acceleratedconnectionscheck,equals(basics('fortiGateInstanceArchitecture'),'x64'),not(contains(steps('instance').instancetype_x64.selection_x64, 'v5')))]"
              },
              {
                "name": "AccelConnwarning",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Warning",
                  "text": "This feature is currently in Preview, please contact Fortinet at 'azuretech@fortinet.com'. Verify the limitations with Microsoft on supported regions. Currently Dv5 instance types are not supported.",
                  "uri": "https://learn.microsoft.com/en-us/azure/networking/nva-accelerated-connections"
                },
                "visible": "[and(steps('networking').acceleratednetworksection.acceleratedconnectionscheck,equals(basics('fortiGateInstanceArchitecture'),'x64'),not(contains(steps('instance').instancetype_x64.selection_x64, 'v5')))]"
              }
            ]
          }
        ]
      },
      {
        "name": "publicip",
        "label": "Public IP",
        "subLabel": {
          "preValidation": "Configure public networking",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "1niccheck",
            "type": "Microsoft.Common.CheckBox",
            "label": "Deploy one-armed 1 NIC setup for internal traffic inspection",
            "toolTip": "This option enables the deployment of a 1 NIC internal only setup.",
            "visible": true
          },
          {
            "name": "1nicechecktext",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "This deployment will be a one-armed setup with only an internal NIC connected to an internal load balancer."
            },
            "visible": "[steps('publicip').1niccheck]"
          },
          {
            "name": "externalLoadBalancer",
            "type": "Microsoft.Common.Section",
            "label": "External Load Balancer",
            "visible": "[not(steps('publicip').1niccheck)]",
            "elements": [
              {
                "name": "enabled",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Deploy ELB with external subnet",
                "defaultValue": "yes",
                "toolTip": "Deploys an external load balancer and external interface for each FortiGate VM",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "yes",
                      "value": "true"
                    },
                    {
                      "label": "no",
                      "value": "false"
                    }
                  ],
                  "required": true
                },
                "visible": true
              }
            ]
          },
          {
            "name": "outboundConnectivity",
            "type": "Microsoft.Common.Section",
            "label": "Outbound Connectivity",
            "visible": "[not(steps('publicip').1niccheck)]",
            "elements": [
              {
                "name": "outboundconnectivitytext",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Outbound connectivity needs to be configured in Microsoft Azure when using a Standard SKU Load Balancer. Different methods are available to provide the FortiGate outbound connectivity."
                },
                "visible": true
              },
              {
                "name": "options",
                "type": "Microsoft.Common.DropDown",
                "label": "Internet Access Options",
                "defaultValue": "External Load Balancer or External NAT device (e.g. different FortiGate, ...)",
                "toolTip": "Deploy NAT Gateway or attach Public IP address for each FortiGate.",
                "constraints": {
                  "required": false,
                  "allowedValues": [
                    {
                      "label": "Per node standard SKU Public IP address",
                      "value": "per-node-standard-sku-pip"
                    },
                    {
                      "label": "Deploy NAT Gateway",
                      "value": "deploy-nat-gateway"
                    },
                    {
                      "label": "External Load Balancer or External NAT device (e.g. different FortiGate, ...)",
                      "value": "external-nat-device-or-elb"
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "deploynatgatewaytext",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "NAT Gateway public IP will be used for license validation and outbound connections."
                },
                "visible": "[equals(steps('publicip').outboundConnectivity.options,'deploy-nat-gateway')]"
              },
              {
                "name": "pernodestandardskupiptext",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "A Public IP address will be attached to port1 on each FortiGate for license validation and outbound connections."
                },
                "visible": "[equals(steps('publicip').outboundConnectivity.options,'per-node-standard-sku-pip')]"
              },
              {
                "name": "externalloadbalancertext",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "The FortiGate will use the external load balancer (deployed with this template) for outbound connectivity. Beware to configure the outbound rules to prevent port exhaustion.",
                  "uri": "https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections"
                },
                "visible": "[and(equals(steps('publicip').outboundConnectivity.options,'external-nat-device-or-elb'),bool(steps('publicip').externalLoadBalancer.enabled))]"
              },
              {
                "name": "externalnatdevicetext",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "The FortiGate will use the existing infrastructure and NAT capabilities of the VNET for outbound access, e.g. FortiGate"
                },
                "visible": "[and(equals(steps('publicip').outboundConnectivity.options,'external-nat-device-or-elb'),not(bool(steps('publicip').externalLoadBalancer.enabled)))]"
              },
              {
                "name": "externalnatdevicetextnoelb",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "This deployment will be a one-armed setup with only an internal NIC connected to an internal load balancer."
                },
                "visible": "[steps('publicip').1niccheck]"
              }
            ]
          },
          {
            "name": "standardsku",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This deployment requires standard SKU public IP's. On September 30, 2025, Basic SKU public IPs will be retired. Microsoft Azure offers a migration path from a basic to standard SKU public IP.",
              "uri": "https://learn.microsoft.com/en-us/azure/virtual-network/ip-services/public-ip-addresses"
            }
          }
        ]
      },
      {
        "name": "advanced",
        "label": "Advanced",
        "subLabel": {
          "preValidation": "Configure central management",
          "postValidation": "Done"
        },
        "elements": [
          {
            "name": "fortimanager",
            "type": "Microsoft.Common.Section",
            "label": "FortiManager",
            "elements": [
              {
                "name": "fortimanagertext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Connect to FortiManager"
                }
              },
              {
                "name": "enabled",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Connect to FortiManager",
                "defaultValue": "no",
                "toolTip": "FortiManager needs to be reachable from port 1 or port 2 of the FortiGate",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "yes",
                      "value": "yes"
                    },
                    {
                      "label": "no",
                      "value": "no"
                    }
                  ],
                  "required": true
                },
                "visible": true
              },
              {
                "name": "fortimanagerip",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiManager IP address",
                "defaultValue": "",
                "toolTip": "Provide up to 10 IP addresses or DNS names of the FortiManager reachable over port TCP/541",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9 .-]{1,128}$",
                  "validationMessage": "Only alphanumeric characters and dots, dashs and spaces are allowed, and the value must be 1 to 512 characters."
                },
                "visible": true
              },
              {
                "name": "fortimanagerserial",
                "type": "Microsoft.Common.TextBox",
                "label": "FortiManager Serial Number",
                "defaultValue": "",
                "toolTip": "Provide the serial number of the primary FortiManager",
                "constraints": {
                  "required": false,
                  "regex": "^[A-Za-z0-9-]{1,64}$",
                  "validationMessage": "Only alphanumeric characters and a dash are allowed, and the value must be 1 to 64 characters."
                },
                "visible": true
              }
            ],
            "visible": true
          },
          {
            "name": "customdata",
            "type": "Microsoft.Common.Section",
            "label": "Custom Data",
            "elements": [
              {
                "name": "customdatatext",
                "type": "Microsoft.Common.TextBlock",
                "visible": true,
                "options": {
                  "text": "Pass configuration data into the virtual machine while it is being provisioned. This is additional to the configuration for this architecture."
                }
              },
              {
                "name": "config",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Data",
                "toolTip": "Custom Data",
                "placeholder": "Add your required additional configuration here.",
                "multiLine": true,
                "constraints": {
                  "required": false,
                  "validations": [
                    {
                      "regex": "^[\\w\\W\n\t]{0,10240}$",
                      "message": "All characters allowed, max 10240 characters."
                    }
                  ]
                },
                "visible": true
              },
              {
                "name": "standardsku",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "The default configuration already included in this deployment can be found on our github page. ",
                  "uri": "https://github.com/fortinet/azure-templates/blob/main/FortiGate/Active-Active-ELB-ILB/doc/config-provisioning.md"
                }
              }
            ]
          },
          {
            "name": "serialconsole",
            "type": "Microsoft.Common.Section",
            "label": "Serial Console",
            "elements": [
              {
                "name": "enabled",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Enable Serial Console",
                "defaultValue": "yes",
                "toolTip": "Enables the serial console and creates a required storage account.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "yes",
                      "value": "yes"
                    },
                    {
                      "label": "no",
                      "value": "no"
                    }
                  ],
                  "required": true
                },
                "visible": true
              },
              {
                "name": "standardsku",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "This requires a storage account which willl be created during deployment.",
                  "uri": "https://docs.microsoft.com/en-us/troubleshoot/azure/virtual-machines/serial-console-overview"
                }
              }
            ]
          },
          {
            "name": "highavailability",
            "type": "Microsoft.Common.Section",
            "label": "Synchronisation",
            "elements": [
              {
                "name": "fgspsync",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Enable Session Synchronisation",
                "defaultValue": "no",
                "toolTip": "Synchronizes the sessions between FortiGate peers.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "yes",
                      "value": "true"
                    },
                    {
                      "label": "no",
                      "value": "false"
                    }
                  ],
                  "required": true
                },
                "visible": true
              },
              {
                "name": "fgspinfo",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                  "icon": "Info",
                  "text": "This option enabled FGSP session synchronisation to allow assymetric return traffic instead of using SNAT. This option can't be combined with security checks like IPS, AV scanning, ... unless additional options are configured.",
                  "uri": "https://github.com/40net-cloud/fortinet-azure-solutions/tree/main/FortiGate/Active-Active-ELB-ILB#north-south-traffic"
                }
              }
            ]
          },
          {
            "name": "customvhd",
            "type": "Microsoft.Common.Section",
            "label": "Custom VHD",
            "elements": [
              {
                "name": "customvhdcheck",
                "type": "Microsoft.Common.CheckBox",
                "label": "Use Azure compute gallery VHD for deployment",
                "toolTip": "Provide a customer VHD image provided by Fortinet",
                "visible": true
              },
              {
                "name": "customvhdinfo",
                "type": "Microsoft.Common.InfoBox",
                "options": {
                  "icon": "Info",
                  "text": "For BYOL it is possible to upload a specific FortiGate image to Azure provided by support. Provide the resource ID of the required VM image version in the field below.",
                  "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.2.0/azure-administration-guide/392531/deploying-fortigate-vm-from-a-vhd-image-file"
                },
                "visible": "[steps('advanced').customvhd.customvhdcheck]"
              },
              {
                "name": "resourceid",
                "type": "Microsoft.Common.TextBox",
                "label": "Azure Compute Gallery Image Version resource ID",
                "defaultValue": "",
                "toolTip": "Azure Compute Gallery Image Version resource ID",
                "constraints": {
                  "required": false,
                  "validations": [
                    {
                      "regex": "^[\\w\\W\n\t]{0,1024}$",
                      "message": "All characters allowed, max 1024 characters."
                    }
                  ]
                },
                "visible": "[steps('advanced').customvhd.customvhdcheck]"
              }
            ]
          }
        ]
      },
      {
        "name": "tags",
        "label": "Tags",
        "elements": [
          {
            "name": "tagsByResource",
            "type": "Microsoft.Common.TagsByResource",
            "toolTip": "Add tags to Azure Resources",
            "resources": [
              "Microsoft.Compute/availabilitySets",
              "Microsoft.Network/networkSecurityGroups",
              "Microsoft.Network/loadBalancers",
              "Microsoft.Network/publicIPAddresses",
              "Microsoft.Network/networkInterfaces",
              "Microsoft.Compute/virtualMachines",
              "Microsoft.Network/virtualNetworks",
              "Microsoft.Network/routeTables"
            ]
          }
        ]
      },
      {
        "name": "postdeployment",
        "label": "Post Deployment Info",
        "subLabel": {
          "preValidation": "Post Deployment steps to follow",
          "postValidation": "Done"
        },
        "bladeTitle": "Post Deployment Info",
        "elements": [
          {
            "name": "step1",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "Links to best practices and steps to follow after deployment"
            }
          },
          {
            "name": "step2",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "FortiGate-VM Azure administration guide",
              "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.6.0/azure-administration-guide/128029/about-fortigate-vm-for-azure"
            }
          },
          {
            "name": "step3",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Configuration and network flows",
              "uri": "https://github.com/fortinet/azure-templates/tree/main/FortiGate/Active-Active-ELB-ILB#configuration"
            }
          },
          {
            "name": "step4",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Configure outbound rules on the Azure Load Balancer to prevent SNAT port exhaustion",
              "uri": "https://learn.microsoft.com/en-us/azure/load-balancer/troubleshoot-outbound-connection#configure-load-balancer-outbound-rules-to-maximize-snat-ports-per-vm"
            }
          },
          {
            "name": "step5",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "FortiGate SDN Connector",
              "uri": "https://docs.fortinet.com/document/fortigate-public-cloud/7.6.0/azure-administration-guide/502895/configuring-an-sdn-connector-in-azure"
            }
          },
          {
            "name": "step6",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Backup and restore",
              "uri": "https://docs.fortinet.com/document/fortigate/7.6.0/administration-guide/702257/configuration-backups-and-reset"
            }
          },
          {
            "name": "step7",
            "type": "Microsoft.Common.InfoBox",
            "options": {
              "icon": "Info",
              "text": "Limit access to the management interface both via HTTPs and SSH either using an Network Security Group or by configuring the trust-ip on the network interface",
              "uri": "https://community.fortinet.com/t5/FortiGate/Technical-Tip-Limiting-management-access-to-a-dedicated/ta-p/242872"
            }
          }
        ]
      }
    ],
    "outputs": {
      "fortiGateNamePrefix": "[basics('fortiGateNamePrefix')]",
      "fortiGateCount": "[int(basics('fortiGateCount'))]",
      "fortiGateImageSKU_x64": "[if(or(equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.1'),equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'7.6.2'),equals(steps('instance').instancetype_x64.fortiGateImageVersion_x64,'latest')),concat(steps('instance').instancetype_x64.fortiGateImageSKU_x64,'_g2'),steps('instance').instancetype_x64.fortiGateImageSKU_x64)]",
      "fortiGateImageSKU_arm64": "[steps('instance').instancetype_arm64.fortiGateImageSKU_arm64]",
      "fortiGateImageVersion_x64": "[steps('instance').instancetype_x64.fortiGateImageVersion_x64]",
      "fortiGateImageVersion_arm64": "[steps('instance').instancetype_arm64.fortiGateImageVersion_arm64]",
      "fortiGateInstanceArchitecture": "[basics('fortiGateInstanceArchitecture')]",
      "adminUsername": "[basics('adminUsername')]",
      "adminPassword": "[basics('adminPassword')]",
      "location": "[location()]",
      "instanceType_x64": "[steps('instance').instancetype_x64.selection_x64]",
      "instanceType_arm64": "[steps('instance').instancetype_arm64.selection_arm64]",
      "availabilityOptions": "[steps('instance').availabilityOptions.availabilityOptions]",
      "fortiGateLicenseBYOL1": "[steps('instance').fgtLicense.fgt1content]",
      "fortiGateLicenseBYOL2": "[steps('instance').fgtLicense.fgt2content]",
      "fortiGateLicenseBYOL3": "[steps('instance').fgtLicense.fgt3content]",
      "fortiGateLicenseBYOL4": "[steps('instance').fgtLicense.fgt4content]",
      "fortiGateLicenseBYOL5": "[steps('instance').fgtLicense.fgt5content]",
      "fortiGateLicenseBYOL6": "[steps('instance').fgtLicense.fgt6content]",
      "fortiGateLicenseBYOL7": "[steps('instance').fgtLicense.fgt7content]",
      "fortiGateLicenseBYOL8": "[steps('instance').fgtLicense.fgt8content]",
      "fortiGateLicenseFortiFlex1": "[steps('instance').fgtLicense.fgt1fortiflex]",
      "fortiGateLicenseFortiFlex2": "[steps('instance').fgtLicense.fgt2fortiflex]",
      "fortiGateLicenseFortiFlex3": "[steps('instance').fgtLicense.fgt3fortiflex]",
      "fortiGateLicenseFortiFlex4": "[steps('instance').fgtLicense.fgt4fortiflex]",
      "fortiGateLicenseFortiFlex5": "[steps('instance').fgtLicense.fgt5fortiflex]",
      "fortiGateLicenseFortiFlex6": "[steps('instance').fgtLicense.fgt6fortiflex]",
      "fortiGateLicenseFortiFlex7": "[steps('instance').fgtLicense.fgt7fortiflex]",
      "fortiGateLicenseFortiFlex8": "[steps('instance').fgtLicense.fgt8fortiflex]",
      "acceleratedNetworking": "[steps('networking').acceleratednetworksection.acceleratednetworking]",
      "acceleratedConnections": "[steps('networking').acceleratednetworksection.acceleratedconnectionscheck]",
      "acceleratedConnectionsSku": "[steps('networking').acceleratednetworksection.acceleratedconnectionssku]",
      "1nicDeployment": "[steps('publicip').1niccheck]",
      "externalLoadBalancer": "[bool(steps('publicip').externalLoadBalancer.enabled)]",
      "outboundConnectivity": "[steps('publicip').outboundConnectivity.options]",
      "vnetNewOrExisting": "[steps('networking').virtualnetworksection.virtualnetwork.newOrExisting]",
      "vnetName": "[steps('networking').virtualnetworksection.virtualnetwork.name]",
      "vnetResourceGroup": "[steps('networking').virtualnetworksection.virtualnetwork.resourceGroup]",
      "vnetAddressPrefix": "[steps('networking').virtualnetworksection.virtualnetwork.addressPrefix]",
      "subnet1Name": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.name]",
      "subnet1Prefix": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.addressPrefix]",
      "subnet1StartAddress": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet1.startAddress]",
      "subnet2Name": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet2.name]",
      "subnet2Prefix": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet2.addressPrefix]",
      "subnet2StartAddress": "[steps('networking').virtualnetworksection.virtualnetwork.subnets.subnet2.startAddress]",
      "serialConsole": "[steps('advanced').serialconsole.enabled]",
      "fortiManager": "[steps('advanced').fortimanager.enabled]",
      "fortiManagerIP": "[steps('advanced').fortimanager.fortimanagerip]",
      "fortiManagerSerial": "[steps('advanced').fortimanager.fortimanagerserial]",
      "fortiGateAdditionalCustomData": "[steps('advanced').customdata.config]",
      "fortiGateSessionSync": "[bool(steps('advanced').highavailability.fgspsync)]",
      "customImageReference": "[steps('advanced').customvhd.resourceid]",
      "tagsByResource": "[steps('tags').tagsByResource]"
    }
  }
}
